# 病院ナビ南信 要件定義書 v3.0

**〜症状から探す 安心の病院ナビ〜**

---

## 📋 プロジェクト概要

### サービス名

- **メイン**: 病院ナビ南信
- **サブタイトル**: 症状から探す 安心の病院ナビ

### ミッション

「症状があるのに、どの病院に行けばよいか分からない」という地域住民の悩みを解決し、適切な医療機関への受診を促す Web サービス

### 特徴

- 文字入力不要の選択式アンケート
- AI による症状説明文の自動生成
- 南信州エリアに特化した病院情報提供
- シニア層（60 代以上）に配慮した UI 設計

---

## 🎯 ターゲットユーザー

### 主要ターゲット

- **年齢層**: 40 代〜シニア層（特に 60 代以上）
- **特性**:
  - スマートフォンでの文字入力が苦手
  - どの診療科を受診すべきか判断に迷う
  - 症状を言語化して説明することが困難
  - 家族と医療情報を共有したい

### 利用シーン

1. 体調不良を感じたが、どの病院へ行くべきか分からない
2. 症状をうまく説明できる自信がない
3. 家族に症状を正確に伝えたい
4. 地域の病院情報をすぐに知りたい

---

## 💻 機能要件

### 1. アンケート機能（コア機能）

#### 1.1 質問項目

| 質問                   | 選択肢                                                                                    | 選択方式 |
| ---------------------- | ----------------------------------------------------------------------------------------- | -------- |
| どこが気になりますか？ | のど / むね / あたま / おなか / かわ（皮ふ） / 手・足・関節 / め / みみ / 心 / わからない | 単一選択 |
| いつからですか？       | 今日 / 2〜3 日前 / 1 週間くらい / 1 か月くらい / わからない                               | 単一選択 |
| どんな状態ですか？     | 下記参照                                                                                  | 複数選択 |
| 大きさ（条件付き表示） | 小さい（米粒） / 1cm くらい / 2cm 以上 / わからない                                       | 単一選択 |
| 持病                   | なし / 血圧・心臓 / 糖尿 / 骨・関節 / その他 / わからない                                 | 複数選択 |
| 薬                     | のんでいる / のんでいない / わからない                                                    | 単一選択 |
| 自由メモ               | テキスト入力（任意）                                                                      | 自由記述 |

**「どんな状態ですか？」の選択肢：**

- 痛い / 痛くない / 違和感だけ
- ふくらみ・しこり
- 押すと痛い / 押しても痛くない
- 熱がある / 熱はない
- 食べ物が飲み込みづらい
- 声がかすれる
- 息がしづらい
- 吐きけ
- めまい
- けが・ぶつけた
- わからない

### 2. 症状説明文生成機能（テンプレートベース）

#### 2.1 実装方式

- **JavaScript のテンプレートリテラルで実装**
- **外部 API 不要**
- **即座に生成可能**

#### 2.2 生成テンプレート

```
【症状について】
○○が気になります。
症状は「□□」があります。

【いつから】
「△△」から続いています。

【状態】
・痛み：あり / なし
・しこり：あり / なし（大きさ：□□）
・発熱：あり / なし
・飲み込みづらさ：あり / なし
・呼吸のしづらさ：あり / なし

【持病・薬】
持病：□□
薬：あり / なし

【本人のメモ】
（入力があれば表示）

※この内容は参考情報です。診断ではありません。
　必ず医師の診察を受けてください。
```

### 2-B. AI 診断機能（実験的機能）

#### ⚠️ 実装ステータス

- **開発環境**: 実装・テスト用
- **本番環境**: 初期リリース時はコメントアウト
- **将来対応**: 十分な検証後に有効化を検討

#### 2-B.1 AI 診断の実装仕様

- **使用 API**: OpenAI GPT-4o-mini
- **表示位置**: 症状説明文の下に別枠で表示
- **トリガー**: 「AI 診断を試す（実験中）」ボタン（オプション）

#### 2-B.2 AI 診断プロンプトテンプレート

```
あなたは経験豊富な医療アドバイザーです。
以下の症状情報から、可能性のある疾患や受診のアドバイスを提供してください。

【症状情報】
- 部位: {location}
- 期間: {duration}
- 症状: {symptoms}
- 持病: {conditions}
- 服薬: {medicine}
- メモ: {memo}

【回答形式】
1. 考えられる可能性（3つまで）
2. 緊急度の目安（高/中/低）
3. 推奨される診療科
4. 受診時の注意点
5. 日常生活でのケア

重要：これは医学的診断ではなく、参考情報です。
```

#### 2-B.3 AI 診断結果の表示例

```
【AIによる参考分析】※実験的機能

⚠️ これはAIによる分析であり、医学的診断ではありません。
必ず医師の診察を受けてください。

◆考えられる可能性
1. 急性咽頭炎の可能性
2. 扁桃炎の可能性
3. 風邪症候群の可能性

◆緊急度：中
- 2-3日以内の受診をお勧めします

◆推奨診療科
- 耳鼻咽喉科または内科

◆受診時の注意点
- 症状の経過を時系列でメモしておく
- 現在服用中の薬を持参する

◆日常生活でのケア
- 十分な水分補給
- うがいの実施
- 安静を保つ

※このAI分析は実験的機能です。
※医療従事者の判断を優先してください。
```

#### 2-B.4 実装上の注意点

```javascript
// 環境変数で機能の有効/無効を制御
const AI_DIAGNOSIS_ENABLED = process.env.NEXT_PUBLIC_AI_DIAGNOSIS === 'true';

// 本番環境では初期値をfalseに設定
// テスト環境でのみtrueに設定

if (AI_DIAGNOSIS_ENABLED) {
  // AI診断機能を表示
  showAIDiagnosisButton();
}
```

### 3. 病院検索・表示機能

#### 3.1 診療科マッピングロジック

| 症状パターン     | 推奨診療科（優先順） |
| ---------------- | -------------------- |
| のどの症状全般   | 1.耳鼻咽喉科 2.内科  |
| 胸の症状全般     | 1.内科 2.循環器内科  |
| 頭の症状全般     | 1.内科 2.脳神経外科  |
| お腹の症状全般   | 1.内科 2.消化器内科  |
| 皮膚の症状全般   | 1.皮膚科 2.内科      |
| 手足・関節の症状 | 1.整形外科 2.内科    |
| 目の症状         | 1.眼科 2.内科        |
| 耳の症状         | 1.耳鼻咽喉科 2.内科  |
| 心の症状         | 1.心療内科 2.内科    |
| 複数症状・不明   | 内科を優先推奨       |

#### 3.2 表示順序

1. **専門性優先**: 症状に最も適した診療科を持つ病院を上位表示
2. **内科優先**: 複数症状や不明な場合は内科を持つ病院を優先
3. **データ登録順**: 同一優先度の場合は登録順

#### 3.3 病院情報の表示内容

各病院カードに以下を表示：

- **病院名**（大きく表示）
- **診療科**（該当する科を強調表示）
- **住所**
- **電話番号**（タップで発信可能）
- **診療時間**（表示可能な場合）
- **地図で見る**ボタン（Google Maps URL へのリンク）
- **備考**（特記事項がある場合）

### 4. 画像保存機能

#### 4.1 保存対象

- AI 生成した症状説明文のみを画像化
- 病院リストは含まない

#### 4.2 保存後の動作

1. 保存完了メッセージ表示
2. 以下のオプションボタンを表示：
   - 「写真を見る」（デバイスの写真アプリへ）
   - 「LINE で送る」（将来実装）
   - 「トップにもどる」

### 5. 管理機能

#### 5.1 病院データ管理

- **CRUD 操作**: 登録・編集・削除・一覧表示
- **インポート機能**: CSV/Excel 形式での一括登録
- **アクセス制限**: 管理者（1 名）のみアクセス可能

---

## 📊 データベース設計

### hospitals テーブル

| カラム名       | データ型  | 制約          | 説明            |
| -------------- | --------- | ------------- | --------------- |
| id             | UUID      | PRIMARY KEY   | 一意識別子      |
| name           | TEXT      | NOT NULL      | 病院名          |
| category       | TEXT[]    | NOT NULL      | 診療科（複数）  |
| address        | TEXT      | NOT NULL      | 住所            |
| tel            | TEXT      | NOT NULL      | 電話番号        |
| city           | TEXT      | NOT NULL      | 市町村          |
| opening_hours  | TEXT      |               | 診療時間        |
| google_map_url | TEXT      |               | Google Maps URL |
| note           | TEXT      |               | 備考            |
| created_at     | TIMESTAMP | DEFAULT NOW() | 作成日時        |
| updated_at     | TIMESTAMP | DEFAULT NOW() | 更新日時        |

### 管理者認証（Supabase Auth 使用）

- メールアドレス/パスワード認証
- 管理者 1 名のみ登録

---

## 🎨 UI/UX 設計

### デザイン原則

#### シニア向け最適化

1. **文字サイズ**:

   - 標準モード: 18px 以上
   - 大文字モード: 24px 以上
   - 切り替えボタンを画面上部に配置

2. **色彩設計**:

   - 高コントラスト配色
   - 選択中: 濃い青（#1e40af）
   - 未選択: 薄いグレー（#f3f4f6）
   - 重要ボタン: 緑（#16a34a）

3. **レイアウト**:

   - 1 画面完結型（スクロールのみ）
   - 「戻る」操作不要
   - タップ領域: 最小 48px × 48px

4. **フィードバック**:
   - 選択時の視覚的変化を明確に
   - エラー時は赤色で大きく表示
   - 完了時は緑色で成功を明示

### 画面構成

```
[ヘッダー]
- ロゴ・サービス名
- 文字サイズ切替ボタン

[メインコンテンツ]
- アンケート項目（順次表示）
- 選択ボタン群
- まとめボタン

[結果表示エリア]
- AI生成文章
- 画像保存ボタン
- 病院リスト

[フッター]
- 利用規約リンク
- お問い合わせ
```

---

## 🔧 技術仕様

### 技術スタック

| 領域           | 技術          | バージョン  | 備考                       |
| -------------- | ------------- | ----------- | -------------------------- |
| フロントエンド | Next.js       | 15.x        |                            |
| スタイリング   | Tailwind CSS  | 3.x         |                            |
| データベース   | Supabase      | 最新        |                            |
| AI 処理        | OpenAI API    | GPT-4o-mini | 実験的機能用（オプション） |
| 画像生成       | html2canvas   | 最新        |                            |
| 状態管理       | React Hooks   | -           |                            |
| 認証           | Supabase Auth | -           | 管理画面用                 |

### API 設計

#### エンドポイント一覧

| メソッド | パス                       | 説明                 | 認証 | ステータス |
| -------- | -------------------------- | -------------------- | ---- | ---------- |
| POST     | /api/symptoms/generate     | 症状説明文生成       | 不要 | 本番       |
| POST     | /api/symptoms/ai-diagnosis | AI 診断（実験）      | 不要 | テストのみ |
| GET      | /api/hospitals             | 病院リスト取得       | 不要 | 本番       |
| GET      | /api/hospitals/search      | 診療科での検索       | 不要 | 本番       |
| POST     | /api/admin/hospitals       | 病院登録             | 必要 | 本番       |
| PUT      | /api/admin/hospitals/:id   | 病院情報更新         | 必要 | 本番       |
| DELETE   | /api/admin/hospitals/:id   | 病院削除             | 必要 | 本番       |
| POST     | /api/admin/import          | CSV/Excel インポート | 必要 | 本番       |

---

## 📈 開発フェーズ

### Phase 1: MVP 開発（2 週間）

- [ ] 基本 UI 構築
- [ ] アンケート機能実装
- [ ] 症状説明文生成機能（テンプレートベース）
- [ ] 病院リスト表示
- [ ] 画像保存機能

### Phase 2: 管理機能（1 週間）

- [ ] 管理画面構築
- [ ] CRUD 機能実装
- [ ] CSV/Excel インポート機能
- [ ] 認証機能

### Phase 3: 実験的機能開発（3 日）

- [ ] AI 診断機能の実装
- [ ] 環境変数による機能切り替え
- [ ] AI 診断結果の表示 UI
- [ ] 免責事項の強調表示
- [ ] テスト環境での動作確認

### Phase 4: ブラッシュアップ（1 週間）

- [ ] UI/UX 改善
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング強化
- [ ] AI 診断機能の A/B テスト準備
- [ ] 本番環境での AI 機能無効化確認

### Phase 5: 運用準備（3 日）

- [ ] 本番環境構築
- [ ] 病院データ投入
- [ ] 動作確認（AI 機能は OFF）
- [ ] リリース

---

## ⚠️ 法的配慮・制約事項

### 医療法関連

- 「診断」「治療」「処方」等の医療行為を連想させる表現は使用禁止
- 「参考情報」「受診の目安」である旨を明記
- 「必ず医師の診察を受けてください」の文言を必須表示

### AI 診断機能の取り扱い（実験的機能）

- **明確な免責表示**
  - 「AI による分析であり医学的診断ではない」を強調
  - 文字サイズを大きく、赤色等で視認性を確保
- **機能の位置づけ**
  - 「実験的機能」「テスト段階」であることを明示
  - 初期リリースでは無効化（コメントアウト）
- **データの取り扱い**
  - AI 診断の結果は保存しない
  - ログも統計目的のみ

### 個人情報保護

- ユーザーの症状データは保存しない
- アクセスログは統計目的のみ
- 画像保存は端末内のみ（サーバー保存なし）

### 免責事項

- サービス利用規約に免責事項を明記
- 緊急時は 119 番通報を促す文言を表示
- AI 診断機能使用時は追加の同意取得を検討

---

## 🚀 将来の拡張予定

### 検討中の機能

- LINE 公式アカウント連携
- 病院の口コミ・評価機能
- 予約システム連携
- 多言語対応（ポルトガル語等）
- 薬局情報の追加

### 収益化オプション（未定）

- 病院からの情報掲載料
- プレミアム機能（詳細な症状分析等）
- 地域の健康情報配信サービス

---

## 📝 備考

- 開発環境: Claude Code 使用
- デプロイ先: Vercel（予定）
- ドメイン: 取得予定
- SSL: Let's Encrypt
- バックアップ: Supabase 自動バックアップ

---

**最終更新日**: 2025 年 1 月 16 日  
**作成者**: まさゆき  
**バージョン**: 3.0（正式サービス名決定版）
