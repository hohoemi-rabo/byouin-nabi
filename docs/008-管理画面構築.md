# 008 - ç®¡ç†ç”»é¢æ§‹ç¯‰

## æ¦‚è¦
ç—…é™¢ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ç®¡ç†ç”»é¢ã®åŸºæœ¬æ§‹é€ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## ç›®çš„
- ç®¡ç†è€…å°‚ç”¨ã®UIã‚’ä½œæˆ
- èªè¨¼ã‚¬ãƒ¼ãƒ‰æ©Ÿèƒ½ã®å®Ÿè£…
- ç®¡ç†ç”»é¢ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹ç¯‰

## ã‚¿ã‚¹ã‚¯

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ§‹é€ 
- [x] /admin ãƒ«ãƒ¼ãƒˆä½œæˆ
- [x] /admin/layout.tsx ä½œæˆï¼ˆç®¡ç†ç”»é¢å°‚ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
- [x] /admin/dashboard ãƒšãƒ¼ã‚¸ä½œæˆ
- [x] /admin/hospitals ãƒšãƒ¼ã‚¸ä½œæˆ

### èªè¨¼æ©Ÿèƒ½ï¼ˆç°¡æ˜“ç‰ˆ - ç’°å¢ƒå¤‰æ•°ãƒ™ãƒ¼ã‚¹ï¼‰
- [x] ç°¡æ˜“èªè¨¼ã®å®Ÿè£…ï¼ˆCookie + ç’°å¢ƒå¤‰æ•°ï¼‰
- [x] ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆ.env.localï¼‰
- [x] ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ä½œæˆï¼ˆ/admin/loginï¼‰
- [x] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
- [x] èªè¨¼çŠ¶æ…‹ã®ç®¡ç†ï¼ˆCookieãƒ™ãƒ¼ã‚¹ï¼‰

> **æ³¨**: Supabase Auth ã¸ã®ç§»è¡Œã¯å°†æ¥ã®ã‚¿ã‚¹ã‚¯ã¨ã—ã¦è¨ˆç”»ä¸­ï¼ˆãƒã‚±ãƒƒãƒˆ014ã§å¯¾å¿œäºˆå®šï¼‰

### Middleware ã«ã‚ˆã‚‹ä¿è­·
- [x] middleware.ts ã®ä½œæˆ
- [x] /admin/* ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- [x] æœªèªè¨¼æ™‚ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- [x] AdminLayout ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
- [x] ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- [x] ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ï¼‰
- [x] ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [x] ç—…é™¢æ•°ã®è¡¨ç¤º
- [x] å¯¾å¿œå¸‚ç”ºæ‘æ•°ãƒ»è¨ºç™‚ç§‘ç›®æ•°ã®è¡¨ç¤º
- [x] ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

## å®Ÿè£…ä¾‹

```typescript
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  const adminToken = request.cookies.get('admin-token');

  // ç®¡ç†ç”»é¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
  if (request.nextUrl.pathname.startsWith('/admin')) {
    // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¯é™¤å¤–
    if (request.nextUrl.pathname === '/admin/login') {
      return NextResponse.next();
    }

    // æœªèªè¨¼ã®å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    if (!adminToken) {
      return NextResponse.redirect(new URL('/admin/login', request.url));
    }
  }

  return NextResponse.next();
}

export const config = {
  matcher: '/admin/:path*',
};
```

```typescript
// src/app/admin/layout.tsx
import AdminSidebar from '@/components/Admin/AdminSidebar';
import AdminHeader from '@/components/Admin/AdminHeader';

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="flex h-screen bg-gray-100">
      <AdminSidebar />
      <div className="flex-1 flex flex-col">
        <AdminHeader />
        <main className="flex-1 overflow-y-auto p-6">
          {children}
        </main>
      </div>
    </div>
  );
}
```

```typescript
// src/components/Admin/AdminSidebar.tsx
import Link from 'next/link';

export default function AdminSidebar() {
  return (
    <aside className="w-64 bg-gray-800 text-white">
      <div className="p-4">
        <h2 className="text-xl font-bold">ç®¡ç†ç”»é¢</h2>
      </div>
      <nav className="mt-4">
        <Link
          href="/admin/dashboard"
          className="block px-4 py-3 hover:bg-gray-700"
        >
          ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
        </Link>
        <Link
          href="/admin/hospitals"
          className="block px-4 py-3 hover:bg-gray-700"
        >
          ğŸ¥ ç—…é™¢ç®¡ç†
        </Link>
      </nav>
    </aside>
  );
}
```

## å—ã‘å…¥ã‚ŒåŸºæº–
- [x] /admin ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨èªè¨¼ãƒã‚§ãƒƒã‚¯ãŒè¡Œã‚ã‚Œã‚‹
- [x] æœªèªè¨¼æ™‚ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹
- [x] ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [x] ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹
- [x] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [x] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹
- [x] ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

## ä¾å­˜é–¢ä¿‚
- 000-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `/home/masayuki/NextJs/byouin-nabi/middleware.ts`
- `/home/masayuki/NextJs/byouin-nabi/src/app/admin/layout.tsx`
- `/home/masayuki/NextJs/byouin-nabi/src/app/admin/login/page.tsx`
- `/home/masayuki/NextJs/byouin-nabi/src/app/admin/dashboard/page.tsx`
- `/home/masayuki/NextJs/byouin-nabi/src/components/Admin/`

## å®Ÿè£…è©³ç´°

### èªè¨¼ãƒ•ãƒ­ãƒ¼

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `/admin/*` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Middleware ãŒ Cookie `admin-auth` ã‚’ãƒã‚§ãƒƒã‚¯
3. Cookie ãŒãªã„ã€ã¾ãŸã¯å€¤ãŒ `true` ã§ãªã„å ´åˆã¯ `/admin/login` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
4. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
5. `/api/admin/login` ã§ç’°å¢ƒå¤‰æ•° `ADMIN_PASSWORD` ã¨ç…§åˆ
6. æˆåŠŸæ™‚ã« Cookie `admin-auth=true` ã‚’ã‚»ãƒƒãƒˆï¼ˆhttpOnly, secure, sameSite: strict, maxAge: 24æ™‚é–“ï¼‰
7. `/admin/dashboard` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
8. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã¯ `/api/admin/logout` ã§ Cookie ã‚’å‰Šé™¤

### ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

**èªè¨¼é–¢é€£:**
- `/middleware.ts` - èªè¨¼ã‚¬ãƒ¼ãƒ‰
- `/src/app/api/admin/login/route.ts` - ãƒ­ã‚°ã‚¤ãƒ³ API
- `/src/app/api/admin/logout/route.ts` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ API
- `/src/app/admin/login/page.tsx` - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
- `/src/app/admin/layout.tsx` - ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- `/src/components/Admin/AdminSidebar.tsx` - ã‚µã‚¤ãƒ‰ãƒãƒ¼
- `/src/components/Admin/AdminHeader.tsx` - ãƒ˜ãƒƒãƒ€ãƒ¼

**ãƒšãƒ¼ã‚¸:**
- `/src/app/admin/dashboard/page.tsx` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆçµ±è¨ˆè¡¨ç¤ºï¼‰
- `/src/app/admin/hospitals/page.tsx` - ç—…é™¢ä¸€è¦§ãƒšãƒ¼ã‚¸

### ãƒ“ãƒ«ãƒ‰çµæœ

```
âœ“ Compiled successfully in 14.1s
Route (app)                         Size  First Load JS
â”œ â—‹ /admin/dashboard             1.27 kB         121 kB
â”œ â—‹ /admin/hospitals              1.2 kB         121 kB
â”œ â—‹ /admin/login                 1.16 kB         121 kB
Æ’ Middleware                       39 kB
```

## å‚™è€ƒ
- ç®¡ç†è€…ã¯1åã®ã¿ï¼ˆç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ï¼‰
- Supabase Auth ã¸ã®ç§»è¡Œã¯å°†æ¥ã®ã‚¿ã‚¹ã‚¯ï¼ˆãƒã‚±ãƒƒãƒˆ014ï¼‰
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ©Ÿèƒ½ã¯å°†æ¥å®Ÿè£…
- 2è¦ç´ èªè¨¼ã¯å°†æ¥å¯¾å¿œã‚’æ¤œè¨
- ç—…é™¢ã® CRUD æ©Ÿèƒ½ã¯ãƒã‚±ãƒƒãƒˆ009ã§å®Ÿè£…äºˆå®š
