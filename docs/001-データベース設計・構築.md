# 001 - データベース設計・構築

## 概要
Supabaseでのデータベーステーブルの設計と構築を行います。

## 目的
- hospitalsテーブルの作成
- インデックスの設定
- RLS（Row Level Security）の設定

## タスク

### hospitalsテーブル作成
- [ ] テーブル定義のSQLを作成
- [ ] Supabase Studioでテーブルを作成
- [ ] カラム設定の確認
  - [ ] id (UUID, PRIMARY KEY)
  - [ ] name (TEXT, NOT NULL)
  - [ ] category (TEXT[], NOT NULL)
  - [ ] address (TEXT, NOT NULL)
  - [ ] tel (TEXT, NOT NULL)
  - [ ] city (TEXT, NOT NULL)
  - [ ] opening_hours (TEXT)
  - [ ] google_map_url (TEXT)
  - [ ] note (TEXT)
  - [ ] created_at (TIMESTAMP)
  - [ ] updated_at (TIMESTAMP)

### インデックス作成
- [ ] city カラムにインデックス作成
- [ ] category カラムにGINインデックス作成

### RLS設定
- [ ] パブリック読み取りポリシー設定（SELECT）
- [ ] 管理者のみ書き込みポリシー設定（INSERT, UPDATE, DELETE）

### テストデータ投入
- [ ] サンプル病院データ2-3件を投入
- [ ] データ取得のテスト

## SQL

```sql
-- hospitalsテーブル作成
CREATE TABLE hospitals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  category TEXT[] NOT NULL,
  address TEXT NOT NULL,
  tel TEXT NOT NULL,
  city TEXT NOT NULL,
  opening_hours TEXT,
  google_map_url TEXT,
  note TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- インデックス作成
CREATE INDEX idx_hospitals_city ON hospitals(city);
CREATE INDEX idx_hospitals_category ON hospitals USING GIN(category);

-- RLS有効化
ALTER TABLE hospitals ENABLE ROW LEVEL SECURITY;

-- 全ユーザーが読み取り可能
CREATE POLICY "Public hospitals are viewable by everyone"
  ON hospitals FOR SELECT
  USING (true);

-- 認証済みユーザーのみ書き込み可能（管理者チェックは後で追加）
CREATE POLICY "Authenticated users can insert hospitals"
  ON hospitals FOR INSERT
  WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Authenticated users can update hospitals"
  ON hospitals FOR UPDATE
  USING (auth.role() = 'authenticated');

CREATE POLICY "Authenticated users can delete hospitals"
  ON hospitals FOR DELETE
  USING (auth.role() = 'authenticated');
```

## 受け入れ基準
- [ ] hospitalsテーブルが正しく作成されている
- [ ] インデックスが設定されている
- [ ] RLSポリシーが適用されている
- [ ] テストデータの取得ができる

## 依存関係
- 000-プロジェクトセットアップ

## 関連ファイル
- Supabase Studio (https://supabase.com/dashboard)

## 備考
- マイグレーションファイルとしても保存することを推奨
- TypeScript型定義は後で自動生成可能（`supabase gen types typescript`）
