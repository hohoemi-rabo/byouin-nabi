# 001 - データベース設計・構築

## 概要
Supabaseでのデータベーステーブルの設計と構築を行います。

## 目的
- hospitalsテーブルの作成
- インデックスの設定
- RLS（Row Level Security）の設定

## タスク

### hospitalsテーブル作成
- [x] テーブル定義のSQLを作成
- [x] Supabase Studioでテーブルを作成
- [x] カラム設定の確認
  - [x] id (UUID, PRIMARY KEY)
  - [x] name (TEXT, NOT NULL)
  - [x] category (TEXT[], NOT NULL)
  - [x] address (TEXT, NOT NULL)
  - [x] tel (TEXT, NOT NULL)
  - [x] city (TEXT, NOT NULL)
  - [x] opening_hours (TEXT)
  - [x] google_map_url (TEXT)
  - [x] note (TEXT)
  - [x] created_at (TIMESTAMP)
  - [x] updated_at (TIMESTAMP)

### インデックス作成
- [x] city カラムにインデックス作成
- [x] category カラムにGINインデックス作成

### RLS設定
- [x] パブリック読み取りポリシー設定（SELECT）
- [x] 管理者のみ書き込みポリシー設定（INSERT, UPDATE, DELETE）

### テストデータ投入
- [x] サンプル病院データ2-3件を投入
- [x] データ取得のテスト

## SQL

```sql
-- hospitalsテーブル作成
CREATE TABLE hospitals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  category TEXT[] NOT NULL,
  address TEXT NOT NULL,
  tel TEXT NOT NULL,
  city TEXT NOT NULL,
  opening_hours TEXT,
  google_map_url TEXT,
  note TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- インデックス作成
CREATE INDEX idx_hospitals_city ON hospitals(city);
CREATE INDEX idx_hospitals_category ON hospitals USING GIN(category);

-- RLS有効化
ALTER TABLE hospitals ENABLE ROW LEVEL SECURITY;

-- 全ユーザーが読み取り可能
CREATE POLICY "Public hospitals are viewable by everyone"
  ON hospitals FOR SELECT
  USING (true);

-- 認証済みユーザーのみ書き込み可能（管理者チェックは後で追加）
CREATE POLICY "Authenticated users can insert hospitals"
  ON hospitals FOR INSERT
  WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Authenticated users can update hospitals"
  ON hospitals FOR UPDATE
  USING (auth.role() = 'authenticated');

CREATE POLICY "Authenticated users can delete hospitals"
  ON hospitals FOR DELETE
  USING (auth.role() = 'authenticated');
```

## 受け入れ基準
- [x] hospitalsテーブルが正しく作成されている
- [x] インデックスが設定されている
- [x] RLSポリシーが適用されている
- [x] テストデータの取得ができる

## 依存関係
- 000-プロジェクトセットアップ

## 関連ファイル
- Supabase Studio (https://supabase.com/dashboard)

## 備考
- マイグレーションファイルとしても保存することを推奨
- TypeScript型定義は後で自動生成可能（`supabase gen types typescript`）
