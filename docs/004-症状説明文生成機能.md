# 004 - 症状説明文生成機能（テンプレートベース）

## 概要
アンケート回答を元に、テンプレートベースで症状説明文を自動生成します。

## 目的
- ユーザーの症状を分かりやすい文章にまとめる
- 外部API不要で即座に生成
- 医師への説明時に活用できる形式

## タスク

### テンプレートエンジン実装
- [ ] 症状説明文生成関数の作成
- [ ] テンプレートリテラルでの文章組み立て
- [ ] 条件分岐ロジックの実装

### API ルート作成
- [ ] `/api/symptoms/generate` エンドポイント作成
- [ ] リクエストバリデーション
- [ ] エラーハンドリング

### 結果表示コンポーネント
- [ ] SymptomDescription コンポーネント作成
- [ ] 生成された文章の表示
- [ ] 免責事項の表示
- [ ] コピー機能（オプション）

### テンプレート仕様
- [ ] 【症状について】セクション
- [ ] 【いつから】セクション
- [ ] 【状態】セクション
- [ ] 【持病・薬】セクション
- [ ] 【本人のメモ】セクション
- [ ] 免責事項の追加

## 実装例

```typescript
// src/lib/generateSymptomDescription.ts
export function generateSymptomDescription(data: QuestionnaireData): string {
  let description = '【症状について】\n';
  description += `${data.location}が気になります。\n`;

  if (data.symptoms.length > 0) {
    description += `症状は「${data.symptoms.join('、')}」があります。\n`;
  }

  description += '\n【いつから】\n';
  description += `「${data.duration}」から続いています。\n`;

  description += '\n【状態】\n';
  description += `・痛み：${data.symptoms.includes('痛い') ? 'あり' : 'なし'}\n`;
  description += `・しこり：${data.symptoms.includes('ふくらみ・しこり') ? 'あり' : 'なし'}`;

  if (data.lumpSize) {
    description += `（大きさ：${data.lumpSize}）`;
  }
  description += '\n';

  description += `・発熱：${data.symptoms.includes('熱がある') ? 'あり' : 'なし'}\n`;

  description += '\n【持病・薬】\n';
  description += `持病：${data.conditions.join('、') || 'なし'}\n`;
  description += `薬：${data.medicine}\n`;

  if (data.memo) {
    description += '\n【本人のメモ】\n';
    description += data.memo + '\n';
  }

  description += '\n※この内容は参考情報です。診断ではありません。\n';
  description += '　必ず医師の診察を受けてください。';

  return description;
}
```

```typescript
// src/app/api/symptoms/generate/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { generateSymptomDescription } from '@/lib/generateSymptomDescription';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();

    // バリデーション
    if (!body.location || !body.duration) {
      return NextResponse.json(
        { error: '必須項目が入力されていません' },
        { status: 400 }
      );
    }

    const description = generateSymptomDescription(body);

    return NextResponse.json({ description });
  } catch (error) {
    console.error('Symptom generation error:', error);
    return NextResponse.json(
      { error: '症状説明文の生成に失敗しました' },
      { status: 500 }
    );
  }
}
```

## 受け入れ基準
- [ ] アンケート回答から症状説明文が正しく生成される
- [ ] 全てのセクションが適切にフォーマットされる
- [ ] 条件分岐（しこりの大きさなど）が正しく動作する
- [ ] 免責事項が必ず表示される
- [ ] エラーハンドリングが適切に実装されている

## 依存関係
- 003-アンケート機能実装

## 関連ファイル
- `/home/masayuki/NextJs/byouin-nabi/src/lib/generateSymptomDescription.ts`
- `/home/masayuki/NextJs/byouin-nabi/src/app/api/symptoms/generate/route.ts`
- `/home/masayuki/NextJs/byouin-nabi/src/components/SymptomResult/SymptomDescription.tsx`
- `/home/masayuki/NextJs/byouin-nabi/src/app/results/page.tsx`

## 備考
- この機能は外部APIを使用せず、完全にローカルで動作
- 生成速度は即座（ネットワーク不要）
- 将来的にテンプレートのカスタマイズが可能
