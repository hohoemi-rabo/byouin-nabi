# 005 - 診療科マッピング機能

## 概要
ユーザーの症状から推奨される診療科を判定するロジックを実装します。

## 目的
- 症状に基づいて適切な診療科を提案
- 複数の候補を優先順位付きで提示
- 病院検索の絞り込みに利用

## タスク

### マッピングロジック実装
- [x] 症状→診療科のマッピングテーブル作成
- [x] 複数症状の場合の優先度判定
- [x] 不明・複数症状の場合の内科優先ロジック

### 診療科判定関数
- [x] getDepartments 関数の作成
- [x] 優先順位の決定ロジック
- [ ] テストケースの作成 ※実装スキップ（チケット013で実施予定）

### 結果表示
- [x] 推奨診療科の表示コンポーネント
- [x] 優先順位の視覚化
- [x] 「内科をまず受診してください」メッセージ

## マッピングテーブル

```typescript
// src/lib/departmentMapping.ts
export const DEPARTMENT_MAPPING: Record<string, string[]> = {
  'のど': ['耳鼻咽喉科', '内科'],
  'むね': ['内科', '循環器内科'],
  'あたま': ['内科', '脳神経外科'],
  'おなか': ['内科', '消化器内科'],
  'かわ（皮ふ）': ['皮膚科', '内科'],
  '手・足・関節': ['整形外科', '内科'],
  'め': ['眼科', '内科'],
  'みみ': ['耳鼻咽喉科', '内科'],
  '心': ['心療内科', '内科'],
  'わからない': ['内科']
};

export function getDepartments(location: string, symptoms: string[]): string[] {
  // 基本的なマッピング
  const departments = DEPARTMENT_MAPPING[location] || ['内科'];

  // 複数症状や緊急性の高い症状がある場合の調整
  const hasEmergency = symptoms.some(s =>
    ['息がしづらい', '食べ物が飲み込みづらい', '熱がある'].includes(s)
  );

  if (hasEmergency) {
    // 緊急性が高い場合は内科を優先
    return ['内科', ...departments.filter(d => d !== '内科')];
  }

  return departments;
}
```

## 受け入れ基準
- [x] 各症状部位に対して適切な診療科が返される
- [x] 複数の診療科が優先順位付きで返される
- [x] 「わからない」選択時は内科が返される（実装では「その他」）
- [x] 緊急性の高い症状では内科が優先される
- [ ] ユニットテストが通過する ※実装スキップ（チケット013で実施予定）

## ユニットテスト例

```typescript
// src/lib/departmentMapping.test.ts
describe('getDepartments', () => {
  it('should return 耳鼻咽喉科 and 内科 for のど', () => {
    const result = getDepartments('のど', []);
    expect(result).toEqual(['耳鼻咽喉科', '内科']);
  });

  it('should prioritize 内科 for emergency symptoms', () => {
    const result = getDepartments('のど', ['息がしづらい']);
    expect(result[0]).toBe('内科');
  });

  it('should return 内科 for わからない', () => {
    const result = getDepartments('わからない', []);
    expect(result).toEqual(['内科']);
  });
});
```

## 依存関係
- 003-アンケート機能実装

## 関連ファイル
- `/home/masayuki/NextJs/byouin-nabi/src/lib/departmentMapping.ts`
- `/home/masayuki/NextJs/byouin-nabi/src/lib/departmentMapping.test.ts`

## 備考
- マッピングテーブルは将来的に管理画面から編集可能にすることを検討
- 診療科名は病院データベースの category カラムと一致させる
- 地域の医療事情に応じて調整が必要
