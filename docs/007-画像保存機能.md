# 007 - ç”»åƒä¿å­˜æ©Ÿèƒ½

## æ¦‚è¦
ç—‡çŠ¶èª¬æ˜æ–‡ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ã—ã¦ç«¯æœ«ã«ä¿å­˜ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

## ç›®çš„
- ç—‡çŠ¶èª¬æ˜æ–‡ã‚’ç”»åƒã¨ã—ã¦ä¿å­˜
- å®¶æ—ã‚„åŒ»å¸«ã¸ã®å…±æœ‰ã‚’å®¹æ˜“ã«
- ã‚µãƒ¼ãƒãƒ¼ã«ã¯ä¿å­˜ã›ãšç«¯æœ«å†…ã®ã¿

## ã‚¿ã‚¹ã‚¯

### html2canvas å°å…¥
- [ ] html2canvas ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- [ ] å‹å®šç¾©ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ç”»åƒä¿å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ImageSaveButton ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå‡¦ç†ã®å®Ÿè£…
- [ ] ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®å®Ÿè£…
- [ ] LoadingçŠ¶æ…‹ã®è¡¨ç¤º

### UI/UX
- [ ] ä¿å­˜å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ä¿å­˜å¾Œã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
  - [ ] ã€Œå†™çœŸã‚’è¦‹ã‚‹ã€ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
  - [ ] ã€Œãƒˆãƒƒãƒ—ã«ã‚‚ã©ã‚‹ã€

### ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- [ ] ä¿å­˜å¯¾è±¡ã‚¨ãƒªã‚¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³
- [ ] ç”»åƒåŒ–æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¿æ•´
- [ ] èƒŒæ™¯è‰²ãƒ»ä½™ç™½ã®è¨­å®š

## å®Ÿè£…ä¾‹

```typescript
// src/components/SymptomResult/ImageSaveButton.tsx
'use client';

import { useState } from 'react';
import html2canvas from 'html2canvas';

export default function ImageSaveButton({ targetId }: { targetId: string }) {
  const [isLoading, setIsLoading] = useState(false);
  const [isSaved, setIsSaved] = useState(false);

  const handleSave = async () => {
    setIsLoading(true);

    try {
      const element = document.getElementById(targetId);
      if (!element) {
        throw new Error('ä¿å­˜å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }

      const canvas = await html2canvas(element, {
        backgroundColor: '#ffffff',
        scale: 2, // é«˜è§£åƒåº¦
      });

      // Canvas ã‚’ Blob ã«å¤‰æ›
      canvas.toBlob((blob) => {
        if (!blob) {
          throw new Error('ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `ç—‡çŠ¶èª¬æ˜_${new Date().getTime()}.png`;
        link.click();

        URL.revokeObjectURL(url);
        setIsSaved(true);
      });
    } catch (error) {
      console.error('Image save error:', error);
      alert('ç”»åƒã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div>
      <button
        onClick={handleSave}
        disabled={isLoading}
        className="bg-success text-white px-6 py-3 rounded-lg text-lg font-bold min-h-[48px] hover:bg-success-dark disabled:opacity-50"
      >
        {isLoading ? 'ä¿å­˜ä¸­...' : 'ğŸ“¸ ç—‡çŠ¶èª¬æ˜ã‚’ç”»åƒã§ä¿å­˜'}
      </button>

      {isSaved && (
        <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
          <p className="text-green-800 font-bold mb-3">âœ“ ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸ</p>
          <div className="flex gap-3">
            <button
              onClick={() => window.location.href = '/'}
              className="bg-white border border-gray-300 px-4 py-2 rounded hover:bg-gray-50"
            >
              ãƒˆãƒƒãƒ—ã«ã‚‚ã©ã‚‹
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
```

```typescript
// src/app/results/page.tsx ã§ã®ä½¿ç”¨ä¾‹
<div id="symptom-description" className="bg-white p-6 rounded-lg shadow">
  <SymptomDescription description={description} />
</div>

<ImageSaveButton targetId="symptom-description" />
```

## package.json è¿½åŠ 

```json
{
  "dependencies": {
    "html2canvas": "^1.4.1"
  },
  "devDependencies": {
    "@types/html2canvas": "^1.0.0"
  }
}
```

## å—ã‘å…¥ã‚ŒåŸºæº–
- [ ] ç—‡çŠ¶èª¬æ˜æ–‡ãŒç”»åƒã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹
- [ ] ç”»åƒã®å“è³ªãŒååˆ†ã§ã‚ã‚‹ï¼ˆé«˜è§£åƒåº¦ï¼‰
- [ ] ä¿å­˜å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä¿å­˜å¾Œã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚µãƒ¼ãƒãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ãŒé€ä¿¡ã•ã‚Œãªã„ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã¿ï¼‰

## ä¾å­˜é–¢ä¿‚
- 004-ç—‡çŠ¶èª¬æ˜æ–‡ç”Ÿæˆæ©Ÿèƒ½

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `/home/masayuki/NextJs/byouin-nabi/src/components/SymptomResult/ImageSaveButton.tsx`
- `/home/masayuki/NextJs/byouin-nabi/src/app/results/page.tsx`
- `/home/masayuki/NextJs/byouin-nabi/package.json`

## å‚™è€ƒ
- html2canvas ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®ã¿å‹•ä½œï¼ˆ'use client' å¿…é ˆï¼‰
- iOS Safari ã§ã¯æŒ™å‹•ãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ã€ååˆ†ãªãƒ†ã‚¹ãƒˆãŒå¿…è¦
- å°†æ¥çš„ã«LINEå…±æœ‰æ©Ÿèƒ½ã‚’è¿½åŠ äºˆå®šï¼ˆWeb Share API ä½¿ç”¨ï¼‰
- ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯PNGï¼ˆé€éãªã—ã€ç™½èƒŒæ™¯ï¼‰
